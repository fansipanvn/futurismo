#+OPTIONS: toc:nil
* CIFS
** 概要
   SMB プロトコルを正式にドキュメント化して仕様を公開することで,
   Windows 以外のオペレーティングシステム (OS) やインターネット上を介して
   ファイル共有サービス等を利用できるように拡張したものが CIFS.

  - [[http://ja.wikipedia.org/wiki/Server_Message_Block][Server Message Block - Wikipedia]]

*** 主な特徴
   - CIFS はインターネットで標準的に利用される TCP/IP を基盤としている.
   - CIFS を使用するアプリケーションとして Samba が知られている.
   - CIFS を実装したファイル共有ソフトウェアは Windows に内蔵されている
   - UNIX 系 OS では, Samba を利用する.
     Windows のファイル共有機能を使ってアクセスできるようになっている.
   - CIFS は, NetBIOS インターフェイスを経由せず,
     ただ 1 つの TCP のポート (445 番) だけでサービスできるように改良されたプロトコル.
     使用するポートが 1 つだけでよいので, ファイアウォールなどでの管理も容易.
   - CIFS defines a series of commands used to pass information between networked computers.

** CIFS が WAN で遅い理由.
  - 1 つの Ack に対し, 最大で 1514 バイト× 2 (=3K バイト) のデータしか送信できない.
  - CIFS の通信では, 送信したデータに対する Ack が返ってくるまで, 送信側は次のデータを送信しない.

  - [[http://itpro.nikkeibp.co.jp/article/COLUMN/20070606/273782/][ネット設計を激変させる WAN 高速化装置]]

  ファイル共有のスループットは同様には計算できない. 
  なぜなら, Windows ファイル共有が SMB のブロックサイズを使用して通信しているから

  - エクスプローラ: コアモードという転送方式で, 使用されるブロックサイズが 4KB
  - コマンドプロンプト: Raw モードという転送方式で, 使用されるブロックサイズが 60~64KB

  - 引用元: [[http://www.itmedia.co.jp/enterprise/articles/0706/12/news004.html][最適化から始まる, WAN 高速化への道:「アプリケーションが遅い」をなくす仕組み (2) (1/3) - ITmedia エンタープライズ]]

** Links
   Microsoft CIFS ドキュメント
  - [[http://msdn.microsoft.com/en-us/library/ee442092.aspx][Common Internet File System (CIFS) Protocol]]
    
  Microsoft SMB ドキュメント
  - [[http://msdn.microsoft.com/en-us/library/cc246482.aspx][Server Message Block (SMB) Protocol Versions 2 and 3]]
    
  これがとてもよい入門記事
  - [[http://www.atmarkit.co.jp/ait/articles/0410/29/news103.html][基礎から学ぶ Windows ネットワーク: ファイル共有プロトコル SMB/CIFS - ＠ IT]]

  SNIA の出しているリファレンス
  - https://www.thursby.com/sites/default/files/files/CIFS-TR-1p00_FINAL.pdf

  CIFS のパケットキャプチャについて
  - [[http://www.slideshare.net/hebikuzure/smb-packet][パケット キャプチャで学ぶSMB (CIFS) の基本]]

  この本の SMB の章が大変わかりやすい
  - [[http://www.amazon.co.jp/%E7%8F%BE%E5%A0%B4%E3%81%A7%E4%BD%BF%E3%81%88%E3%82%8B%E3%83%91%E3%82%B1%E3%83%83%E3%83%88%E8%A7%A3%E6%9E%90%E3%83%86%E3%82%AF%E3%83%8B%E3%83%83%E3%82%AF-NETWORK-MAGAZINE-BOOKS/dp/4756150187][Amazon.co.jp: 現場で使えるパケット解析テクニック (NETWORK MAGAZINE BOOKS) (NETWORK MAGAZINE BOOKS): 大羽 康仁: 本]]

  唯一の? CIFS の本. Web で読める. C 言語での実装例が掲載されている.
  - [[http://ubiqx.org/cifs/][Implementing CIFS]]

* SMB
  Server Message Block (SMB) は, 主に Windows で使用されている
  OSI 参照モデル第 7 層アプリケーション層部分の独自通信プロトコルの総称.

  - [[http://ja.wikipedia.org/wiki/Server_Message_Block][Server Message Block - Wikipedia]]

  SMB は Microsoft 社独自のプロトコルで仕様も正式には公開されていなかった.

* SAMBA
  マイクロソフトの Windows ネットワークを実装したフリーソフトウェア.
  Linux, Solaris, BSD, Mac OS X などの Unix 系 OS を用いて,
  Windows のファイルサーバやプリントサービス, ドメインコントローラ機能,
  ドメイン参加機能を提供する.

  - [[http://ja.wikipedia.org/wiki/Samba][Samba - Wikipedia]]

** smbTorture
   smbtorture は Samba サーバが想定されたように動作しているかを確かめる, 
   テスト用クライアントツール.
   - [[https://users.miraclelinux.com/technet/samba30/torture.html][Samba 国際化プロジェクト:ミラクル・リナックス]]
   - [[http://samba.2283325.n4.nabble.com/SMBTorture-tests-td2516754.html][Samba - cifs-protocol - SMBTorture tests]]

** Links
  - [[http://futurismo.biz/archives/1390][CentOS 上で SAMBA サーバを立ちあげて Windows からアクセスするためのメモ]]

* Storage との関係
** CIFS 対応の Storage 製品
*** NAS (ETERNUS NR)
    NAS では, 装置内にファイルシステムを持っており, 
    サーバは NFS あるいは CIFS プロトコルにより, ファイルとしてアクセスする.

   - [[http://storage-system.fujitsu.com/jp/lib-f/tech/beginner/nas/][ストレージ ETERNUS ストレージ技術解説 NAS (ナス) とは  : 富士通]]
   - [[http://storage-system.fujitsu.com/jp/products/nwdiskarray/nr1000f/][ストレージ FUJITSU Storage ETERNUS NR1000F series ネットワークディスクアレイ : 富士通]]

*** Unified Storage (ETERNUS DX S3)
    ユニファイドストレージとは, 1 台で SAN と NAS の両方に対応するストレージ製品.
    NAS は, ネットワークに直接接続するストレージです. LAN (Ethernet) に接続し,
    NFS や CIFS などのプロトコルを介してファイル単位でのアクセスを行う.

    - [[http://storage-system.fujitsu.com/jp/products/diskarray/feature/unified/][ストレージ FUJITSU Storage ETERNUS SAN/NAS 統合ストレージ環境のサポート ユニファイド対応 ETERNUS DX S3 : 富士通]]

*** Software-Defined Storage (???)
    決められたポリシーに従って動的にストレージサービスを構築する製品.
    仮想 NAS がポリシーによって生成されて,
    NFS や CIFS などのプロトコルを介して生成されたファイルサービスにアクセスする.
    (のではないか?)

    - [[http://chucksblog.typepad.com/chucks_blog/2014/04/building-an-sds-conceptual-model-part-1.html][Building A SDS Conceptual Model - Part 1 - Chuck's Blog]]

** SNIA は CIFS に関する情報がたくさんある
   - SNIA はそもそも Storage Networking Industory Association.
     というくらいなので, ストレージネットワーキングの促進団体だったことが判明!

   - SDC の資料が公開されていて, そのなかに CIFS の資料がたくさんあった.
   [[http://www.snia.org/events/storage-developer/archive][Storage Developer Conference Archives | Storage Networking Industry Association]]
