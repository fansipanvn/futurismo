#+BLOG: Futurismo
#+POSTID: 2403
#+DATE: [2014-04-27 日 15:18]
#+OPTIONS: toc:nil num:nil todo:nil pri:nil tags:nil ^:nil TeX:nil
#+CATEGORY: Emacs, 技術メモ
#+TAGS: Sphinx
#+DESCRIPTION: Emacs org-modeで書いたテキストをRestructured Textに変換する方法を調べました
#+TITLE: org-modeで書いたテキストをPandocでRestructured Textに変換する

#+BEGIN_HTML
<img alt="" src="http://futurismo.biz/wp-content/uploads/emacs_logo.jpg"/>
#+END_HTML

* やりたいこと
org-modeで書いたテキストをRestructured Textに変換したい。

Pandocを利用すると、org-modeの文章を変換することができる。

#+BEGIN_HTML
<pre><code>入力(org-mode) -> 変換(Pandoc) -> 出力(Restructured Text)
</code></pre>
#+END_HTML

* Pandocをつかう
Pandocとは、汎用的なドキュメント変換ツール。
ある形式から別の形式へドキュメントの形式を変換できる。

- [[http://sky-y.github.io/site-pandoc-jp/users-guide/][Pandoc ユーザーズガイド 日本語版 - Japanese Pandoc User's Association]]
- [[http://qiita.com/sky_y/items/80bcd0f353ef5b8980ee][HTML - 多様なフォーマットに対応！ドキュメント変換ツールPandocを知ろう - Qiita]]

org-modeのwriterは以前からあったが、readerは最近ようやくpull requestされた。

- [[https://github.com/jgm/pandoc/issues/476][Org-Mode Reader · Issue #476 · jgm/pandoc]]
- https://github.com/jgm/pandoc/commit/b1e6ea80fde0c3a21336747cd34a3ab0ddfe3cfe

ということで、最新の Pandocを試してみる。githubからダウンロード。

- https://github.com/jgm/pandoc

pandocはhaskellでかかれてるので、ビルドにはhaskellがひつよう。

- [[http://johnmacfarlane.net/pandoc/installing.html][Pandoc - Installing]]

以下を順々に実施。

#+BEGIN_HTML
<pre><code>cabal install alex happy
cabal update
cabal install pandoc
git submodule update --init
$ pandoc -v
pandoc 1.12.3.3
Compiled with texmath 0.6.6.1, highlighting-kate 0.5.6.1.
</code></pre>
#+END_HTML

** 実験
これがゴール。

#+BEGIN_HTML
<blockquote>
Hello Sphinx
============

テスト。

テスト
======

テストです。
</blockquote>
#+END_HTML

これを変換する。

#+BEGIN_HTML
<blockquote>
 * Hello Sphinx

 テスト。

 * テスト

 テストです。
</blockquote>
#+END_HTML

変換はコマンドラインから以下を実行

#+BEGIN_HTML
<pre><code>pandoc -f rst hello2.org
</code></pre>
#+END_HTML

こうなった。

#+BEGIN_HTML
<pre><code>
-  Hello Sphinx

テスト。

-  テスト

テストです。
</code></pre>
#+END_HTML

箇条がきではなくて、見出しなのだが。。。今後に期待ということで。

* org-pandocをつかう
org-pandocをというツールをつかっても、
panodcに対応した色々なフォーマットに変換できる。

- [[https://github.com/robtillotson/org-pandoc][robtillotson/org-pandoc]]


仕組みは、一度org-modeからmarkdownに変換して、
markdownをpandocにかけるというもの。

** 実験
変換には、以下を評価したあとに、M-x org-pandoc-export-to-pandoc実行。

#+BEGIN_HTML
<pre><code>(require 'ox-pandoc)
(setq org-pandoc-export-format 'rst)
</code></pre>
#+END_HTML

こうなった。

#+BEGIN_HTML
<blockquote>
======
hello2
======

:Author: tsu-nera

.. raw:: html

   <div id="table-of-contents">
   \<h2\>

Table of Contents

.. raw:: html

   \</h2\>
   <div id="text-table-of-contents">
   <ul>
   <li>

1. Hello Sphinx

.. raw:: html

   </li>
   <li>

2. テスト

.. raw:: html

   </li>
   </ul>
   </div>
   </div>

Hello Sphinx
============

テスト。

テスト
======

テストです。
</blockquote>
#+END_HTML

ヘッダによけいなものがたくさんつくものの、default pandocよりいいな。

* org-mode から markdown経由で reSTへ変換する

MarkdownからreSTへの変換はいろいろな人がチャレンジして実績があるので、この道を考える。

org-modeには、デフォルトでmarkdown変換コマンドあり。 MarkDownどころか、HTML,Pandoc,LATex.. いろいろある。

- http://orgmode.org/manual/Markdown-export.html

詳しくは、org-export-dispatch(C-c C-e)を実行。

さっきのゴミは、emacs-export機能のオプションを利用すれば消せた。

#+BEGIN_HTML
<pre><code>#+OPTIONS: toc:nil
</code></pre>
#+END_HTML

オプションの詳しい説明は、以下。

- [[http://orgmode.org/manual/Export-settings.html#Export-settings][Export settings - The Org Manual]]
- [[http://d.hatena.ne.jp/tamura70/20100304/org][Emacs org-modeを使ってみる: (29) エクスポートオプション一覧 - 屯遁のパズルとプログラミングの日記]]

** コマンドラインから変換したい
上記の方法は、Emacsのなかで変換処理を行うのだが、
複数ファイルを処理するとするとコマンドラインから変換処理を行いたい。

調べたところ、emacsにはbatchという機能があるようだ。

- [[http://d.hatena.ne.jp/rubikitch/20101107/org2html#][org-mode→HTML変換をする3つの方法 - (rubikitch loves (Emacs Ruby CUI Books))]]
- [[http://shuzo-kino.hateblo.jp/entry/2014/01/02/012905][CLIでemacsのorg-modeを使ってhtml化する - Bye Bye Moore]]
- [[http://www.bookshelf.jp/texi/emacs-20.6-man-jp/emacs_32.html#SEC490][GNU Emacsマニュアル: A. コマンド行引数]]

batchについては今回はわからなかったので、次回に回す。外部ライブラリまわりで苦戦。

#+BEGIN_HTML
<pre><code>emacs hello.org -f org-md-export-to-markdown
</code></pre>
#+END_HTML

とりあえず、なんとなくできるという道が開けた気がした。
